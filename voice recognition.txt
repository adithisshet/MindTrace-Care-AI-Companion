import speech_recognition as sr
from gtts import gTTS
import playsound
import os
import uuid
import datetime
import random

recognizer = sr.Recognizer()

# Memory storage
saved_memories = []
todo_list = []
notes = []

# Helpful wellness tips
wellness_tips = [
    "Try recalling three happy moments from your past.",
    "Take slow deep breaths. It calms your mind.",
    "A short walk can refresh your brain.",
    "Drink water regularly to stay healthy.",
    "Try naming five objects around you as a memory exercise.",
]

# Positive affirmations
affirmations = [
    "You are doing great today.",
    "You are strong and capable.",
    "Every day you are improving.",
    "You are loved and cared for.",
    "You are not alone. I am here with you."
]

# Daily routine
daily_routine = [
    "Wake up at 7 AM.",
    "Have breakfast at 8 AM.",
    "Take your morning medicine at 9 AM.",
    "Lunch at 1 PM.",
    "Evening walk at 5 PM.",
    "Dinner at 8 PM.",
    "Sleep by 10 PM."
]

# Simple memory training questions
memory_prompts = [
    "What is your favourite food?",
    "Do you remember who visited you last?",
    "Can you name a happy moment from your childhood?",
    "What is your favourite song?",
    "What is your favourite place to visit?"
]

def speak(text):
    filename = f"{uuid.uuid4()}.mp3"
    tts = gTTS(text=text, lang='en')
    tts.save(filename)
    playsound.playsound(filename)
    os.remove(filename)

def listen():
    with sr.Microphone() as source:
        recognizer.adjust_for_ambient_noise(source, duration=0.4)
        audio = recognizer.listen(source)
        try:
            return recognizer.recognize_google(audio).lower()
        except:
            speak("Sorry, I didn't hear you.")
            return None

def assistant():
    speak("Hello, I am your MindTrace Care assistant. How may I help you today?")

    while True:
        command = listen()
        if not command:
            continue

        # Time
        if "time" in command:
            current_time = datetime.datetime.now().strftime("%I:%M %p")
            speak("The current time is " + current_time)

        # Date
        elif "date" in command:
            today = datetime.datetime.now().strftime("%B %d, %Y")
            speak("Today is " + today)

        # Save memory
        elif "save memory" in command or "remember this" in command:
            speak("Sure. What memory should I save?")
            memory = listen()
            if memory:
                saved_memories.append(memory)
                speak("Memory saved successfully.")

        # Recall memory
        elif "recall memory" in command or "show memory" in command:
            if saved_memories:
                speak("Here are your saved memories.")
                for m in saved_memories:
                    speak(m)
            else:
                speak("You do not have any saved memories yet.")

        # Daily routine
        elif "routine" in command or "my day" in command:
            speak("Here is your daily routine.")
            for r in daily_routine:
                speak(r)

        # Positive affirmations
        elif "motivate me" in command or "affirmation" in command:
            speak(random.choice(affirmations))

       
        # To-do list
        elif "add to list" in command:
            speak("What should I add?")
            item = listen()
            if item:
                todo_list.append(item)
                speak("Added to your list.")

        elif "show my list" in command or "to do" in command:
            if todo_list:
                speak("Your to-do list contains:")
                for item in todo_list:
                    speak(item)
            else:
                speak("Your to-do list is empty.")

        elif "clear list" in command:
            todo_list.clear()
            speak("Your list has been cleared.")

        # Notes
        elif "save note" in command:
            speak("What note should I save?")
            note = listen()
            if note:
                notes.append(note)
                speak("Your note has been saved.")

        elif "read notes" in command:
            if notes:
                speak("Here are your notes.")
                for n in notes:
                    speak(n)
            else:
                speak("You have no notes saved.")

        # Wellness tip
        elif "tip" in command or "wellness" in command:
            speak(random.choice(wellness_tips))

        # Breathing exercise
        elif "help me relax" in command or "breathing" in command:
            speak("Okay, let's relax together. Breathe in... and breathe out...")
            for _ in range(3):
                speak("Breathe in...")
                speak("Breathe out...")

        # Memory training prompt
        elif "help me remember" in command:
            speak(random.choice(memory_prompts))

        # Safety check
        elif "check on me" in command:
            speak("Are you feeling okay? Do you need help?")
            response = listen()
            if response and ("yes" in response or "help" in response):
                speak("I am alerting your caregiver now.")

        # Greetings
        elif "hello" in command or "hi" in command:
            speak("Hello. How can I assist you?")

        # Emergency help
        elif "help" in command or "emergency" in command:
            speak("Please stay calm. I am alerting your caregiver right away.")

        # Exit
        elif "exit" in command or "quit" in command or "stop" in command:
            speak("Goodbye. Stay safe and take care.")
            break

        # Default response
        else:
            speak(command)

assistant()
